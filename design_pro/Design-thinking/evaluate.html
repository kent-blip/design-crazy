<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>評価セッション</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>評価セッション</h1>
  <form id="evaluationForm"></form>
  <button id="submitBtn">評価を提出</button>

  <script>
    // URLからアイデアを取得
    const params = new URLSearchParams(window.location.search);
    const ideas = JSON.parse(decodeURIComponent(params.get("ideas")));

    const form = document.getElementById("evaluationForm");

    // 評価観点
    const criteria = [
      "Whoの立場になった時に共感できる内容か？",
      "現状、他の方法では実現できていない願望か？",
      "新規性（既存の解決策が無い）の高い方法か？",
      "ニーズを実現するために有効な解決法か？（技術的実現可能性も含む）"
    ];

    // アイデアごとにカード生成
    ideas.forEach((idea, idx) => {
      const div = document.createElement("div");
      div.classList.add("idea-card");

      div.innerHTML = `<h3>アイデア ${idx+1}</h3>
      <p><strong>Who:</strong> ${idea.who}</p>
      <p><strong>Where:</strong> ${idea.where}</p>
      <p><strong>When:</strong> ${idea.when}</p>
      <p><strong>What:</strong> ${idea.what}</p>
      <p><strong>Why:</strong> ${idea.why}</p>
      <p><strong>How:</strong> ${idea.how}</p>
      `;

      criteria.forEach((c, ci) => {
        const label = document.createElement("label");
        label.textContent = c + " ";

        for (let score = 1; score <= 4; score++) {
          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = `idea${idx}_q${ci}`;
          radio.value = score;
          label.appendChild(radio);
          label.appendChild(document.createTextNode(score + " "));
        }

        div.appendChild(label);
        div.appendChild(document.createElement("br"));
      });

      form.appendChild(div);
    });

    // 提出処理
    document.getElementById("submitBtn").addEventListener("click", () => {
      const results = {};

      ideas.forEach((idea, idx) => {
        results[`idea${idx+1}`] = { text: idea, scores: {} };

        criteria.forEach((c, ci) => {
          const radios = document.getElementsByName(`idea${idx}_q${ci}`);
          let value = null;
          for (const r of radios) {
            if (r.checked) value = parseInt(r.value, 10);
          }
          results[`idea${idx+1}`].scores[`q${ci+1}`] = value;
        });
      });

      console.log("評価結果:", results);

      const nextUrl = "eva_result.html?data=" + encodeURIComponent(JSON.stringify(results));
      window.location.href = nextUrl;
    });
  </script>
</body>
</html>
